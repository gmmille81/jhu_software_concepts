{% extends 'base.html' %}
{% block head %}
  {{ super() }}  <!-- keep base head content -->
  {% if db_running %}
    <!-- Refresh the canonical analysis URL (not the current POST route URL). -->
    <meta http-equiv="refresh" content="2;url={{ url_for('main.index') }}">
  {% endif %}
{% endblock %}

{% block content %}
<!-- Top row: Page title + buttons -->
<div class="page-header-row">
    <h1>{% block title %}Analysis{% endblock %}</h1>

    <div class="top-buttons">
        <div class="button-block">
            <form action="{{ url_for('main.update_db_route') }}" method="post">
                <button type="submit" class="btn btn-primary" data-testid="pull-data-btn">Pull Data</button>
            </form>
        </div>

        <div class="button-block">
            <form action="{{ url_for('main.update_analysis_route') }}" method="post">
                <button type="submit" class="btn btn-secondary" data-testid="update-analysis-btn">Update Analysis</button>
            </form>
        </div>
    </div>
</div>
{% if message %}
<div id="message" 
     class="{% if 'complete' in message.lower() or 'updated' in message.lower() %}success{% elif 'in progress' in message.lower()%}in-progress{% else %}error{% endif %}">
  {{ message }}
</div>
{% endif %}

<!-- Stacked Descriptions -->
<div class="description-stack">
    <div class="description">
        <p>
            <strong>Pull Data:</strong> Calculates how many records are missing between the most recent submission on theGradCafe.com and our database. 
            It will then scrape new records from theGradCafe.com, clean them, and add them to our SQL database for analysis.
        </p>
    </div>

    <div class="description">
        <p>
            <strong>Update Analysis:</strong> Queries the current SQL database to answer the questions listed below and accordingly updates the answers on this page.
        </p>
    </div>
</div>




<div class="questions-container">
  {% for question in applicant_data %}
  <div class="question-card">
    <h3>{{ question[0] }}</h3>
    <p class="answer"><strong>Answer: </strong>{{ question[1] }}</p>
  </div>
  {% endfor %}
</div>
{% endblock %}
